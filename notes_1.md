Итак, в первую очередь нам нужно записать математическую постановку задачи.

По условию задачи у нас есть три этапа. Назовём их `k = 1`, `k = 2` и `k = 3` в порядке их следования друг за другом.

Перед каждым этапом `k` у нас есть состояние системы `S_k`, которое задаётся вектором из четырёх числе: количество денег в ЦБ1, ЦБ2, Депозитах (Деп.) и Свободных денежных средствах (СДС). Например, для `S_1` (состояние до начала первого этапа) мы имеем `S_1 = (100, 800, 400, 600)`.

Также перед каждым этапом мы можем совершить некое действие `x_k` по ребалансировке (покупки и продаже активов). В задании сказано, что мы можем продавать и покупать активы только пакетами, стоимость которых равна 25% от изначальной стоимости актива. То есть активы имеют следующий размер пакета:

- `ЦБ1: 100 * 25% = 25 (д.е.)`
- `ЦБ2: 800 * 25% = 200 (д.е.)`
- `Деп.: 400 * 25% = 100 (д.е.)`

Будем трактовать условия задачи так, что размеры этих пакетов одинаковы на всех этапах (т.к. в задании речь идёт об "одной четверти от первоначальной стоимости").

После совершения действия наступает этап в котором происходит событие `w_k`, когда реализуется один из трёх возможных сценариев (позитивный, нейтральный или негативный) и стоимость активов изменяется в соответствии с реализованным сценарием. Запишем сценарии для этапов в виде таблиц:

**Этап №1:**

| Ситуация | Вероят. | ЦБ1 | ЦБ2 | Деп. |
|--|--|--|--|--|
| Благопр. | 0,60 | 1,20 | 1,10 | 1,07 |
| Нейтр. | 0,30 | 1,05 | 1,02 | 1,03 |
| Негатив. | 0,10 | 0,80 | 0,95 | 1,00 |

**Этап №2:**

| Ситуация | Вероят. | ЦБ1 | ЦБ2 | Деп. |
|--|--|--|--|--|
| Благопр. | 0,30 | 1,4 | 1,15 | 1,01 |
| Нейтр. | 0,20 | 1,05 | 1,00 | 1,00 |
| Негатив. | 0,50 | 0,60 | 0,90 | 1,00 |

**Этап №3:**

| Ситуация | Вероят. | ЦБ1 | ЦБ2 | Деп. |
|--|--|--|--|--|
| Благопр. | 0,40 | 1,15 | 1,12 | 1,05 |
| Нейтр. | 0,40 | 1,05 | 1,01 | 1,01 |
| Негатив. | 0,20 | 0,70 | 0,94 | 1,00 |

Видим, что эти вероятностные сценарии существенно усложняют систему, а потому давайте избавимся от вероятностей и перейдём к ожидаемому изменению стоимости для каждого актива. То есть объединим три сценария и их вероятности в одно значение ожидаемого изменения стоимости актива. Для этого воспользуемся формулой математического ожидания, которая имеет следующий вид:

`E(X) = Σ [x_i * p_i]`

где:

- `x_i` - возможные значения случайной величины
- `p_i` - их вероятности

Используя эту формулу, рассчитаем для каждого этапа ожидаемые значения изменения стоимости для каждого актива:

**Этап №1:**

- `ЦБ1: (0,60 * 1,20) + (0,30 * 1,05) + (0,10 * 0,80) = 1,115`
- `ЦБ2: (0,60 * 1,10) + (0,30 * 1,02) + (0,10 * 0,95) = 1,061`
- `Деп.: (0,60 * 1,07) + (0,30 * 1,03) + (0,10 * 1,00) = 1,051`

**Этап №2:**

- `ЦБ1: (0,30 * 1,40) + (0,20 * 1,05) + (0,50 * 0,60) = 0,93`
- `ЦБ2: (0,30 * 1,15) + (0,20 * 1,00) + (0,50 * 0,90) = 0,995`
- `Деп.: (0,30 * 1,01) + (0,20 * 1,00) + (0,50 * 1,00) = 1,003`

**Этап №3:**

- `ЦБ1: (0,40 * 1,15) + (0,40 * 1,05) + (0,20 * 0,70) = 1,02`
- `ЦБ2: (0,40 * 1,12) + (0,40 * 1,01) + (0,20 * 0,94) = 1,04`
- `Деп.: (0,40 * 1,05) + (0,40 * 1,01) + (0,20 * 1,00) = 1,024`

Запишем полученные результаты в виде таблицы:

| Этап | ЦБ1 | ЦБ2 | Деп. |
|--|--|--|--|
| 1 | 1,115 | 1,061 | 1,051 |
| 2 | 0,93 | 0,995 | 1,003 |
| 3 | 1,02 | 1,04 | 1,024 |

Видим, что благодаря формуле математического ожидания нам удалось объединить три таблицы с вероятностными сценариями в одну таблицу с ожидаемым изменением цены, что существенно упростило систему.

Итак, в результате событие `w_k` для этапа `k` будет иметь вид вектора из трёх чисел - ожидаемых значений изменения цены для каждого из трёх активов. Например, для первого этапа `w_1 = (1,115; 0,93; 1,02)`.

Пока для каждого `k` получаем следующую последовательность перехода от одного состояния к другому:

`S_k -> x_k -> w_k -> S_{k+1}`

Однако помимо вышеперечисленных условий в задаче дополнительно указана комиссия брокера за совершение операций с активами:

- `ЦБ1: 4%`
- `ЦБ2: 7%`
- `Деп.: 5%`

Эти комиссии снижают выгодность операций купили продажи, так как за каждую такую операцию придётся заплатить соответствующий процент от стоимости операции.

Также в задании указаны следующие ограничения на минимальный размер активов:

- `ЦБ1: Не менее 30 д.е.`
- `ЦБ2: Не менее 150 д.е.`
- `Деп.: Не менее 100 д.е.`

То есть полностью продать какой-либо актив мы также не можем.

Вот, собственно, и все основные условия задачи.
